#include <Arduino.h>
#include <CheapStepper.h> //SE DEBE AÑADIR ESTA LIBRERIA

// Definimos variables para saber la posición del motor

// Pines de motor paso a paso
CheapStepper stepper(5, 18, 19, 21);
CheapStepper stepper1(13, 12, 14, 27);

// LDRS
const int luzUPLEFT = 34;
const int luzUPRIGHT = 35;
const int luzDOWNLEFT=32;
const int luzDOWMRIGHT=33;
// VARIABLES DONDE GUARDAR LOS VALORES ADC DE LOS LDR
int valorLdrUPLEFT;
int valorLdrUPRIGHT;
int valorLdrDOWMLEFT;
int valorLdrDOWMRIGHT;
// Variable que guarda el sentido de giro
boolean moveClockwise = true;
boolean moveClockwise1 = true;

// Variable que guarda la posición de manera estática
static int posicion = 0;
static int posicion1 = 0;
static int ultimo_valor;

void setup()
{
  Serial.begin(9600);
  stepper.setRpm(10);
  stepper.moveTo(moveClockwise, 0);
  stepper1.setRpm(10);
  stepper1.moveTo(moveClockwise, 0);
  delay(1000);
}

void loop()
{

  // GUARDAMOS LOS VALORES OBTENIDOS POR LOS LDR EN SUS RESPECTIVAS VARIABLES
  valorLdrUPLEFT = analogRead(luzUPLEFT);
  valorLdrUPRIGHT = analogRead(luzUPRIGHT);
  valorLdrDOWMLEFT=analogRead(luzDOWNLEFT);
  valorLdrDOWMRIGHT=analogRead(luzDOWMRIGHT);
  delay(1000);
  if (posicion >= 0 && posicion < 180 && valorLdrUPLEFT > 3900)
  {
    moveClockwise = true;
    stepper.moveDegrees(moveClockwise, 20);
    posicion = posicion + 20;
    ultimo_valor=posicion;
  }
  if (posicion <= 180 && posicion > 0 && valorLdrUPRIGHT > 3900)
  {
    moveClockwise = true;
    stepper.moveDegrees(moveClockwise, 20);
    posicion = posicion - 20;
    ultimo_valor=posicion;
  }
  if (posicion1 >= 0 && posicion1 < 180 && valorLdrDOWMLEFT > 3900)
  {
    moveClockwise1 = false;
    stepper1.moveDegrees(moveClockwise1, 20);
    posicion1 = posicion1 + 20;
  }
  if (posicion1 <= 180 && posicion1 > 0 && valorLdrDOWMRIGHT > 3900)
  {
    moveClockwise1 = false;
    stepper1.moveDegrees(moveClockwise1, 20);
    posicion1 = posicion1 - 20;
  }

  Serial.println(ultimo_valor);
  delay(1000);
  //Serial.println(posicion1);
  //delay(1000);
}
